{"version":3,"file":"track.js","sources":["../core/dist/index.esm.js","track/track.ts"],"sourcesContent":["import { __assign } from 'tslib';\n\nvar isSafari = typeof window !== 'undefined' &&\r\n    /^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);\r\n// TODO: queue all of these in a debounceNextTick\r\nfunction nextTick(fn) {\r\n    // React native\r\n    if (typeof setImmediate === 'function' && typeof window === 'undefined') {\r\n        return setImmediate(fn);\r\n    }\r\n    // TODO: should this be setImmediate instead? Forgot if that is micro or macro task\r\n    // TODO: detect specifically if is server\r\n    // if (typeof process !== 'undefined' && process.nextTick) {\r\n    //   console.log('process.nextTick?');\r\n    //   process.nextTick(fn);\r\n    //   return;\r\n    // }\r\n    // FIXME: fix the real safari issue of this randomly not working\r\n    if (isSafari || typeof MutationObserver === 'undefined') {\r\n        setTimeout(fn);\r\n        return;\r\n    }\r\n    var called = 0;\r\n    var observer = new MutationObserver(function () { return fn(); });\r\n    var element = document.createTextNode('');\r\n    observer.observe(element, {\r\n        characterData: true,\r\n    });\r\n    // tslint:disable-next-line\r\n    element.data = String((called = ++called));\r\n}\n\n// TODO: unit tests\r\nvar QueryString = /** @class */ (function () {\r\n    function QueryString() {\r\n    }\r\n    QueryString.parseDeep = function (queryString) {\r\n        var obj = this.parse(queryString);\r\n        return this.deepen(obj);\r\n    };\r\n    QueryString.stringifyDeep = function (obj) {\r\n        var map = this.flatten(obj);\r\n        return this.stringify(map);\r\n    };\r\n    QueryString.parse = function (queryString) {\r\n        var query = {};\r\n        var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');\r\n        for (var i = 0; i < pairs.length; i++) {\r\n            var pair = pairs[i].split('=');\r\n            // TODO: node support?\r\n            query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');\r\n        }\r\n        return query;\r\n    };\r\n    QueryString.stringify = function (map) {\r\n        var str = '';\r\n        for (var key in map) {\r\n            if (map.hasOwnProperty(key)) {\r\n                var value = map[key];\r\n                if (str) {\r\n                    str += '&';\r\n                }\r\n                str += encodeURIComponent(key) + '=' + encodeURIComponent(value);\r\n            }\r\n        }\r\n        return str;\r\n    };\r\n    QueryString.deepen = function (map) {\r\n        var output = {};\r\n        for (var k in map) {\r\n            var t = output;\r\n            var parts = k.split('.');\r\n            var key = parts.pop();\r\n            while (parts.length) {\r\n                var part = parts.shift();\r\n                t = t[part] = t[part] || {};\r\n            }\r\n            t[key] = map[k];\r\n        }\r\n        return output;\r\n    };\r\n    QueryString.flatten = function (obj, _current, _res) {\r\n        if (_res === void 0) { _res = {}; }\r\n        for (var key in obj) {\r\n            var value = obj[key];\r\n            var newKey = _current ? _current + '.' + key : key;\r\n            if (value && typeof value === 'object') {\r\n                this.flatten(value, newKey, _res);\r\n            }\r\n            else {\r\n                _res[newKey] = value;\r\n            }\r\n        }\r\n        return _res;\r\n    };\r\n    return QueryString;\r\n}());\n\nvar version = \"1.0.60-alpha.4\";\n\nvar Subscription = /** @class */ (function () {\r\n    function Subscription(listeners, listener) {\r\n        this.listeners = listeners;\r\n        this.listener = listener;\r\n        this.unsubscribed = false;\r\n        this.otherSubscriptions = [];\r\n    }\r\n    Subscription.prototype.add = function (subscription) {\r\n        this.otherSubscriptions.push(subscription);\r\n    };\r\n    Subscription.prototype.unsubscribe = function () {\r\n        if (this.unsubscribed) {\r\n            return;\r\n        }\r\n        if (this.listener && this.listeners) {\r\n            var index = this.listeners.indexOf(this.listener);\r\n            if (index) {\r\n                this.listeners.splice(index, 1);\r\n            }\r\n        }\r\n        this.otherSubscriptions.forEach(function (sub) { return sub.unsubscribe(); });\r\n        this.unsubscribed = true;\r\n    };\r\n    return Subscription;\r\n}());\r\n// TODO: follow minimal basic spec: https://github.com/tc39/proposal-observable\r\nvar BehaviorSubject = /** @class */ (function () {\r\n    function BehaviorSubject(value) {\r\n        this.value = value;\r\n        this.listeners = [];\r\n        this.errorListeners = [];\r\n    }\r\n    BehaviorSubject.prototype.next = function (value) {\r\n        this.value = value;\r\n        for (var _i = 0, _a = this.listeners; _i < _a.length; _i++) {\r\n            var listener = _a[_i];\r\n            listener(value);\r\n        }\r\n    };\r\n    // TODO: implement this as PIPE instead\r\n    BehaviorSubject.prototype.map = function (fn) {\r\n        var newSubject = new BehaviorSubject(fn(this.value));\r\n        // TODO: on destroy delete these\r\n        this.subscribe(function (val) {\r\n            newSubject.next(fn(val));\r\n        });\r\n        this.catch(function (err) {\r\n            newSubject.error(err);\r\n        });\r\n        return newSubject;\r\n    };\r\n    BehaviorSubject.prototype.catch = function (errorListener) {\r\n        this.errorListeners.push(errorListener);\r\n        return new Subscription(this.errorListeners, errorListener);\r\n    };\r\n    BehaviorSubject.prototype.error = function (error) {\r\n        for (var _i = 0, _a = this.errorListeners; _i < _a.length; _i++) {\r\n            var listener = _a[_i];\r\n            listener(error);\r\n        }\r\n    };\r\n    BehaviorSubject.prototype.subscribe = function (listener, errorListener) {\r\n        this.listeners.push(listener);\r\n        if (errorListener) {\r\n            this.errorListeners.push(errorListener);\r\n        }\r\n        return new Subscription(this.listeners, listener);\r\n    };\r\n    BehaviorSubject.prototype.toPromise = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var subscription = _this.subscribe(function (value) {\r\n                resolve(value);\r\n                subscription.unsubscribe();\r\n            }, function (err) {\r\n                reject(err);\r\n                subscription.unsubscribe();\r\n            });\r\n        });\r\n    };\r\n    BehaviorSubject.prototype.promise = function () {\r\n        return this.toPromise();\r\n    };\r\n    return BehaviorSubject;\r\n}());\n\nvar State = {\r\n    Pending: 'Pending',\r\n    Fulfilled: 'Fulfilled',\r\n    Rejected: 'Rejected',\r\n};\r\nfunction isFunction(val) {\r\n    return val && typeof val === 'function';\r\n}\r\nfunction isObject(val) {\r\n    return val && typeof val === 'object';\r\n}\r\nvar TinyPromise = /** @class */ (function () {\r\n    function TinyPromise(executor) {\r\n        this._state = State.Pending;\r\n        this._handlers = [];\r\n        this._value = null;\r\n        executor(this._resolve.bind(this), this._reject.bind(this));\r\n    }\r\n    TinyPromise.prototype._resolve = function (x) {\r\n        var _this = this;\r\n        if (x instanceof TinyPromise) {\r\n            x.then(this._resolve.bind(this), this._reject.bind(this));\r\n        }\r\n        else if (isObject(x) || isFunction(x)) {\r\n            var called_1 = false;\r\n            try {\r\n                var thenable = x.then;\r\n                if (isFunction(thenable)) {\r\n                    thenable.call(x, function (result) {\r\n                        if (!called_1)\r\n                            _this._resolve(result);\r\n                        called_1 = true;\r\n                        return undefined;\r\n                    }, function (error) {\r\n                        if (!called_1)\r\n                            _this._reject(error);\r\n                        called_1 = true;\r\n                        return undefined;\r\n                    });\r\n                }\r\n                else {\r\n                    this._fulfill(x);\r\n                }\r\n            }\r\n            catch (ex) {\r\n                if (!called_1) {\r\n                    this._reject(ex);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._fulfill(x);\r\n        }\r\n    };\r\n    TinyPromise.prototype._fulfill = function (result) {\r\n        var _this = this;\r\n        this._state = State.Fulfilled;\r\n        this._value = result;\r\n        this._handlers.forEach(function (handler) { return _this._callHandler(handler); });\r\n    };\r\n    TinyPromise.prototype._reject = function (error) {\r\n        var _this = this;\r\n        this._state = State.Rejected;\r\n        this._value = error;\r\n        this._handlers.forEach(function (handler) { return _this._callHandler(handler); });\r\n    };\r\n    TinyPromise.prototype._isPending = function () {\r\n        return this._state === State.Pending;\r\n    };\r\n    TinyPromise.prototype._isFulfilled = function () {\r\n        return this._state === State.Fulfilled;\r\n    };\r\n    TinyPromise.prototype._isRejected = function () {\r\n        return this._state === State.Rejected;\r\n    };\r\n    TinyPromise.prototype._addHandler = function (onFulfilled, onRejected) {\r\n        this._handlers.push({\r\n            onFulfilled: onFulfilled,\r\n            onRejected: onRejected,\r\n        });\r\n    };\r\n    TinyPromise.prototype._callHandler = function (handler) {\r\n        if (this._isFulfilled() && isFunction(handler.onFulfilled)) {\r\n            handler.onFulfilled(this._value);\r\n        }\r\n        else if (this._isRejected() && isFunction(handler.onRejected)) {\r\n            handler.onRejected(this._value);\r\n        }\r\n    };\r\n    TinyPromise.prototype.then = function (onFulfilled, onRejected) {\r\n        var _this = this;\r\n        switch (this._state) {\r\n            case State.Pending: {\r\n                return new TinyPromise(function (resolve, reject) {\r\n                    _this._addHandler(function (value) {\r\n                        nextTick(function () {\r\n                            try {\r\n                                if (isFunction(onFulfilled)) {\r\n                                    resolve(onFulfilled(value));\r\n                                }\r\n                                else {\r\n                                    resolve(value);\r\n                                }\r\n                            }\r\n                            catch (ex) {\r\n                                reject(ex);\r\n                            }\r\n                        });\r\n                    }, function (error) {\r\n                        nextTick(function () {\r\n                            try {\r\n                                if (isFunction(onRejected)) {\r\n                                    resolve(onRejected(error));\r\n                                }\r\n                                else {\r\n                                    reject(error);\r\n                                }\r\n                            }\r\n                            catch (ex) {\r\n                                reject(ex);\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            case State.Fulfilled: {\r\n                return new TinyPromise(function (resolve, reject) {\r\n                    nextTick(function () {\r\n                        try {\r\n                            if (isFunction(onFulfilled)) {\r\n                                resolve(onFulfilled(_this._value));\r\n                            }\r\n                            else {\r\n                                resolve(_this._value);\r\n                            }\r\n                        }\r\n                        catch (ex) {\r\n                            reject(ex);\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            case State.Rejected: {\r\n                return new TinyPromise(function (resolve, reject) {\r\n                    nextTick(function () {\r\n                        try {\r\n                            if (isFunction(onRejected)) {\r\n                                resolve(onRejected(_this._value));\r\n                            }\r\n                            else {\r\n                                reject(_this._value);\r\n                            }\r\n                        }\r\n                        catch (ex) {\r\n                            reject(ex);\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    };\r\n    return TinyPromise;\r\n}());\r\nvar Promise$1 = (typeof Promise !== 'undefined' ? Promise : TinyPromise);\n\n// Webpack workaround to conditionally require certain external modules\r\n// only on the server and not bundle them on the client\r\nvar serverOnlyRequire;\r\ntry {\r\n    // tslint:disable-next-line:no-eval \r\n    serverOnlyRequire = eval('require');\r\n}\r\ncatch (err) {\r\n    // all good\r\n    serverOnlyRequire = (function () { return null; });\r\n}\r\nvar serverOnlyRequire$1 = serverOnlyRequire;\n\nfunction promiseResolve(value) {\r\n    return new Promise$1(function (resolve) { return resolve(value); });\r\n}\r\n// Adapted from https://raw.githubusercontent.com/developit/unfetch/master/src/index.mjs\r\nfunction tinyFetch(url, options) {\r\n    if (options === void 0) { options = {}; }\r\n    return new Promise$1(function (resolve, reject) {\r\n        var request = new XMLHttpRequest();\r\n        request.open(options.method || 'get', url, true);\r\n        if (options.headers) {\r\n            for (var i in options.headers) {\r\n                request.setRequestHeader(i, options.headers[i]);\r\n            }\r\n        }\r\n        request.withCredentials = options.credentials === 'include';\r\n        request.onload = function () {\r\n            resolve(response());\r\n        };\r\n        request.onerror = reject;\r\n        request.send(options.body);\r\n        function response() {\r\n            var keys = [];\r\n            var all = [];\r\n            var headers = {};\r\n            var header = undefined;\r\n            request\r\n                .getAllResponseHeaders()\r\n                .replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm, function (_match, _key, value) {\r\n                var key = _key;\r\n                keys.push((key = key.toLowerCase()));\r\n                all.push([key, value]);\r\n                header = headers[key];\r\n                headers[key] = header ? header + \",\" + value : value;\r\n                return '';\r\n            });\r\n            return {\r\n                ok: ((request.status / 100) | 0) === 2,\r\n                status: request.status,\r\n                statusText: request.statusText,\r\n                url: request.responseURL,\r\n                clone: response,\r\n                text: function () { return promiseResolve(request.responseText); },\r\n                json: function () { return promiseResolve(request.responseText).then(JSON.parse); },\r\n                blob: function () { return promiseResolve(new Blob([request.response])); },\r\n                headers: {\r\n                    keys: function () { return keys; },\r\n                    entries: function () { return all; },\r\n                    get: function (n) { return headers[n.toLowerCase()]; },\r\n                    has: function (n) { return n.toLowerCase() in headers; },\r\n                },\r\n            };\r\n        }\r\n    });\r\n}\r\nvar fetch = typeof global === 'object' && typeof global.fetch === 'function'\r\n    ? global.fetch\r\n    : typeof window === 'undefined'\r\n        ? serverOnlyRequire$1('node-fetch')\r\n        : typeof window.fetch !== 'undefined'\r\n            ? window.fetch\r\n            : tinyFetch;\n\nfunction assign(target) {\r\n    var args = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        args[_i - 1] = arguments[_i];\r\n    }\r\n    var to = Object(target);\r\n    for (var index = 1; index < arguments.length; index++) {\r\n        var nextSource = arguments[index];\r\n        if (nextSource != null) {\r\n            // Skip over if undefined or null\r\n            for (var nextKey in nextSource) {\r\n                // Avoid bugs when hasOwnProperty is shadowed\r\n                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\r\n                    to[nextKey] = nextSource[nextKey];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return to;\r\n}\n\nfunction throttle(func, wait, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var context;\r\n    var args;\r\n    var result;\r\n    var timeout = null;\r\n    var previous = 0;\r\n    var later = function () {\r\n        previous = options.leading === false ? 0 : Date.now();\r\n        timeout = null;\r\n        result = func.apply(context, args);\r\n        if (!timeout)\r\n            context = args = null;\r\n    };\r\n    return function () {\r\n        var now = Date.now();\r\n        if (!previous && options.leading === false)\r\n            previous = now;\r\n        var remaining = wait - (now - previous);\r\n        context = this;\r\n        args = arguments;\r\n        if (remaining <= 0 || remaining > wait) {\r\n            if (timeout) {\r\n                clearTimeout(timeout);\r\n                timeout = null;\r\n            }\r\n            previous = now;\r\n            result = func.apply(context, args);\r\n            if (!timeout)\r\n                context = args = null;\r\n        }\r\n        else if (!timeout && options.trailing !== false) {\r\n            timeout = setTimeout(later, remaining);\r\n        }\r\n        return result;\r\n    };\r\n}\n\nvar camelCaseToKebabCase = function (str) {\r\n    return str ? str.replace(/([A-Z])/g, function (g) { return \"-\" + g[0].toLowerCase(); }) : '';\r\n};\r\nvar Animator = /** @class */ (function () {\r\n    function Animator() {\r\n    }\r\n    Animator.prototype.bindAnimations = function (animations) {\r\n        for (var _i = 0, animations_1 = animations; _i < animations_1.length; _i++) {\r\n            var animation = animations_1[_i];\r\n            switch (animation.trigger) {\r\n                case 'pageLoad':\r\n                    this.triggerAnimation(animation);\r\n                    break;\r\n                case 'hover':\r\n                    this.bindHoverAnimation(animation);\r\n                    break;\r\n                case 'scrollInView':\r\n                    this.bindScrollInViewAnimation(animation);\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n    Animator.prototype.warnElementNotPresent = function (id) {\r\n        console.warn(\"Cannot animate element: element with ID \" + id + \" not found!\");\r\n    };\r\n    Animator.prototype.augmentAnimation = function (animation, element) {\r\n        var stylesUsed = this.getAllStylesUsed(animation);\r\n        var computedStyle = getComputedStyle(element);\r\n        // const computedStyle = getComputedStyle(element);\r\n        // // FIXME: this will break if original load is in one reponsive size then resize to another hmmm\r\n        // Need to use transform instead of left since left can change on screen sizes\r\n        var firstStyles = animation.steps[0].styles;\r\n        var lastStyles = animation.steps[animation.steps.length - 1].styles;\r\n        var bothStyles = [firstStyles, lastStyles];\r\n        // FIXME: this won't work as expected for augmented animations - may need the editor itself to manage this\r\n        for (var _i = 0, bothStyles_1 = bothStyles; _i < bothStyles_1.length; _i++) {\r\n            var styles = bothStyles_1[_i];\r\n            for (var _a = 0, stylesUsed_1 = stylesUsed; _a < stylesUsed_1.length; _a++) {\r\n                var style = stylesUsed_1[_a];\r\n                if (!(style in styles)) {\r\n                    styles[style] = computedStyle[style];\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Animator.prototype.getAllStylesUsed = function (animation) {\r\n        var properties = [];\r\n        for (var _i = 0, _a = animation.steps; _i < _a.length; _i++) {\r\n            var step = _a[_i];\r\n            for (var key in step.styles) {\r\n                if (properties.indexOf(key) === -1) {\r\n                    properties.push(key);\r\n                }\r\n            }\r\n        }\r\n        return properties;\r\n    };\r\n    Animator.prototype.triggerAnimation = function (animation) {\r\n        var _this = this;\r\n        // TODO: do for ALL elements\r\n        var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\r\n        if (!elements.length) {\r\n            this.warnElementNotPresent(animation.elementId || animation.id || '');\r\n            return;\r\n        }\r\n        Array.from(elements).forEach(function (element) {\r\n            _this.augmentAnimation(animation, element);\r\n            // TODO: do this properly, may have other animations of different properties\r\n            // TODO: only override the properties\r\n            // TODO: if there is an entrance and hover animation, the transition duration will get effed\r\n            // element.setAttribute('style', '');\r\n            // const styledUsed = this.getAllStylesUsed(animation);\r\n            element.style.transition = 'none';\r\n            element.style.transitionDelay = '0';\r\n            assign(element.style, animation.steps[0].styles);\r\n            // TODO: queue/batch these timeouts\r\n            setTimeout(function () {\r\n                element.style.transition = \"all \" + animation.duration + \"s \" + camelCaseToKebabCase(animation.easing);\r\n                if (animation.delay) {\r\n                    element.style.transitionDelay = animation.delay + 's';\r\n                }\r\n                assign(element.style, animation.steps[1].styles);\r\n                // TODO: maybe remove/reset transitoin property after animation duration\r\n                // TODO: queue timers\r\n                setTimeout(function () {\r\n                    // TODO: what if has other transition (reset back to what it was)\r\n                    element.style.transition = '';\r\n                    element.style.transitionDelay = '';\r\n                }, (animation.delay || 0) * 1000 + animation.duration * 1000 + 100);\r\n            });\r\n        });\r\n    };\r\n    Animator.prototype.bindHoverAnimation = function (animation) {\r\n        var _this = this;\r\n        // TODO: is it multiple binding when editing...?\r\n        // TODO: unbind on element remove\r\n        // TODO: apply to ALL elements\r\n        var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\r\n        if (!elements.length) {\r\n            this.warnElementNotPresent(animation.elementId || animation.id || '');\r\n            return;\r\n        }\r\n        Array.from(elements).forEach(function (element) {\r\n            _this.augmentAnimation(animation, element);\r\n            var defaultState = animation.steps[0].styles;\r\n            var hoverState = animation.steps[1].styles;\r\n            function attachDefaultState() {\r\n                assign(element.style, defaultState);\r\n            }\r\n            function attachHoverState() {\r\n                assign(element.style, hoverState);\r\n            }\r\n            attachDefaultState();\r\n            element.addEventListener('mouseenter', attachHoverState);\r\n            element.addEventListener('mouseleave', attachDefaultState);\r\n            // TODO: queue/batch these timeouts\r\n            setTimeout(function () {\r\n                element.style.transition = \"all \" + animation.duration + \"s \" + camelCaseToKebabCase(animation.easing);\r\n                if (animation.delay) {\r\n                    element.style.transitionDelay = animation.delay + 's';\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // TODO: unbind on element remove\r\n    Animator.prototype.bindScrollInViewAnimation = function (animation) {\r\n        var _this = this;\r\n        // TODO: apply to ALL matching elements\r\n        var elements = Array.prototype.slice.call(document.getElementsByClassName(animation.elementId || animation.id || ''));\r\n        if (!elements.length) {\r\n            this.warnElementNotPresent(animation.elementId || animation.id || '');\r\n            return;\r\n        }\r\n        // TODO: if server side rendered and scrolled into view don't animate...\r\n        Array.from(elements).forEach(function (element) {\r\n            _this.augmentAnimation(animation, element);\r\n            var triggered = false;\r\n            function immediateOnScroll() {\r\n                if (!triggered && isScrolledIntoView(element)) {\r\n                    triggered = true;\r\n                    setTimeout(function () {\r\n                        assign(element.style, animation.steps[1].styles);\r\n                        document.removeEventListener('scroll', onScroll);\r\n                        setTimeout(function () {\r\n                            element.style.transition = '';\r\n                            element.style.transitionDelay = '';\r\n                        }, (animation.duration * 1000 + (animation.delay || 0)) * 1000 + 100);\r\n                    });\r\n                }\r\n            }\r\n            // TODO: roll all of these in one for more efficiency of checking all the rects\r\n            var onScroll = throttle(immediateOnScroll, 200, { leading: false });\r\n            // TODO: fully in view or partially\r\n            function isScrolledIntoView(elem) {\r\n                var rect = elem.getBoundingClientRect();\r\n                var windowHeight = window.innerHeight;\r\n                var thresholdPrecent = 0.05;\r\n                var threshold = thresholdPrecent * windowHeight;\r\n                // TODO: partial in view? or what if element is larger than screen itself\r\n                return (rect.bottom > threshold && rect.top < windowHeight - threshold // Element is peeking top or bottom\r\n                // (rect.top > 0 && rect.bottom < window.innerHeight) || // element fits within the screen and is fully on screen (not hanging off at all)\r\n                // (rect.top < 0 && rect.bottom > window.innerHeight) // element is larger than the screen and hangs over the top and bottom\r\n                );\r\n            }\r\n            var defaultState = animation.steps[0].styles;\r\n            function attachDefaultState() {\r\n                assign(element.style, defaultState);\r\n            }\r\n            attachDefaultState();\r\n            // TODO: queue/batch these timeouts!\r\n            setTimeout(function () {\r\n                element.style.transition = \"all \" + animation.duration + \"s \" + camelCaseToKebabCase(animation.easing);\r\n                if (animation.delay) {\r\n                    element.style.transitionDelay = animation.delay + 's';\r\n                }\r\n            });\r\n            // TODO: one listener for everything\r\n            document.addEventListener('scroll', onScroll, { capture: true, passive: true });\r\n            // Do an initial check\r\n            immediateOnScroll();\r\n        });\r\n    };\r\n    return Animator;\r\n}());\n\n/**\r\n * RegExp to match field-content in RFC 7230 sec 3.2\r\n *\r\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\r\n * field-vchar   = VCHAR / obs-text\r\n * obs-text      = %x80-FF\r\n */\r\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\r\nvar Cookies = /** @class */ (function () {\r\n    function Cookies(request, response) {\r\n        this.request = request;\r\n        this.response = response;\r\n    }\r\n    Cookies.prototype.get = function (name) {\r\n        var header = this.request.headers['cookie'];\r\n        if (!header) {\r\n            return;\r\n        }\r\n        var match = header.match(getPattern(name));\r\n        if (!match) {\r\n            return;\r\n        }\r\n        var value = match[1];\r\n        return value;\r\n    };\r\n    Cookies.prototype.set = function (name, value, opts) {\r\n        var res = this.response;\r\n        var req = this.request;\r\n        var headers = res.getHeader('Set-Cookie') || [];\r\n        // TODO: just make this always true\r\n        var secure = this.secure !== undefined\r\n            ? !!this.secure\r\n            : req.protocol === 'https' || req.connection.encrypted;\r\n        var cookie = new Cookie(name, value, opts);\r\n        if (typeof headers === 'string') {\r\n            headers = [headers];\r\n        }\r\n        if (!secure && opts && opts.secure) {\r\n            throw new Error('Cannot send secure cookie over unencrypted connection');\r\n        }\r\n        cookie.secure = secure;\r\n        if (opts && 'secure' in opts) {\r\n            cookie.secure = !!opts.secure;\r\n        }\r\n        pushCookie(headers, cookie);\r\n        var setHeader = res.setHeader;\r\n        setHeader.call(res, 'Set-Cookie', headers);\r\n        return this;\r\n    };\r\n    return Cookies;\r\n}());\r\nvar Cookie = /** @class */ (function () {\r\n    function Cookie(name, value, attrs) {\r\n        this.path = '/';\r\n        this.domain = undefined;\r\n        this.httpOnly = true;\r\n        this.sameSite = false;\r\n        this.secure = false;\r\n        this.overwrite = false;\r\n        this.name = '';\r\n        this.value = '';\r\n        if (!fieldContentRegExp.test(name)) {\r\n            throw new TypeError('argument name is invalid');\r\n        }\r\n        if (value && !fieldContentRegExp.test(value)) {\r\n            throw new TypeError('argument value is invalid');\r\n        }\r\n        if (!value) {\r\n            this.expires = new Date(0);\r\n        }\r\n        this.name = name;\r\n        this.value = value || '';\r\n        if (attrs.expires) {\r\n            this.expires = attrs.expires;\r\n        }\r\n        if (attrs.secure) {\r\n            this.secure = attrs.secure;\r\n        }\r\n    }\r\n    Cookie.prototype.toString = function () {\r\n        return this.name + \"=\" + this.value;\r\n    };\r\n    Cookie.prototype.toHeader = function () {\r\n        var header = this.toString();\r\n        if (this.maxAge) {\r\n            this.expires = new Date(Date.now() + this.maxAge);\r\n        }\r\n        if (this.path) {\r\n            header += \"; path=\" + this.path;\r\n        }\r\n        if (this.expires) {\r\n            header += \"; expires=\" + this.expires.toUTCString();\r\n        }\r\n        if (this.domain) {\r\n            header += \"; domain=\" + this.domain;\r\n        }\r\n        // TODO: samesite=none by default (?)\r\n        header += \"; SameSite=\" + (this.sameSite === true ? 'strict' : 'None');\r\n        // TODO: On by default\r\n        if (this.secure) {\r\n            header += '; secure';\r\n        }\r\n        if (this.httpOnly) {\r\n            header += '; httponly';\r\n        }\r\n        return header;\r\n    };\r\n    return Cookie;\r\n}());\r\nfunction getPattern(name) {\r\n    return new RegExp(\"(?:^|;) *\" + name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&') + \"=([^;]*)\");\r\n}\r\nfunction pushCookie(headers, cookie) {\r\n    if (cookie.overwrite) {\r\n        for (var i = headers.length - 1; i >= 0; i--) {\r\n            if (headers[i].indexOf(cookie.name + \"=\") === 0) {\r\n                headers.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n    headers.push(cookie.toHeader());\r\n}\n\nfunction omit(obj) {\r\n    var values = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        values[_i - 1] = arguments[_i];\r\n    }\r\n    var newObject = Object.assign({}, obj);\r\n    for (var _a = 0, values_1 = values; _a < values_1.length; _a++) {\r\n        var key = values_1[_a];\r\n        delete newObject[key];\r\n    }\r\n    return newObject;\r\n}\n\nvar isReactNative = typeof navigator === 'object' && navigator.product === 'ReactNative';\r\nvar urlParser = {\r\n    parse: function (url) {\r\n        var parser = document.createElement('a');\r\n        parser.href = url;\r\n        var out = {};\r\n        var props = 'username password host hostname port protocol origin pathname search hash'.split(' ');\r\n        for (var i = props.length; i--;) {\r\n            out[props[i]] = parser[props[i]];\r\n        }\r\n        // IE 11 pathname handling workaround\r\n        // (IE omits preceeding '/', unlike other browsers)\r\n        if ((out.pathname || out.pathname === '') &&\r\n            typeof out.pathname === 'string' &&\r\n            out.pathname.indexOf('/') !== 0) {\r\n            out.pathname = '/' + out.pathname;\r\n        }\r\n        return out;\r\n    },\r\n};\r\nvar parse = isReactNative\r\n    ? function () { return ({}); }\r\n    : typeof window === 'object'\r\n        ? urlParser.parse\r\n        : serverOnlyRequire$1('url').parse;\r\nfunction setCookie(name$$1, value, expires) {\r\n    var expiresString = '';\r\n    // TODO: need to know if secure server side\r\n    if (expires) {\r\n        expiresString = '; expires=' + expires.toUTCString();\r\n    }\r\n    var secure = isBrowser ? location.protocol === 'https:' : true;\r\n    document.cookie =\r\n        name$$1 +\r\n            '=' +\r\n            (value || '') +\r\n            expiresString +\r\n            '; path=/' +\r\n            (secure ? ';secure' : '') +\r\n            '; SameSite=None';\r\n}\r\nfunction getCookie(name$$1) {\r\n    return (decodeURIComponent(document.cookie.replace(new RegExp('(?:(?:^|.*;)\\\\s*' +\r\n        encodeURIComponent(name$$1).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') +\r\n        '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'), '$1')) || null);\r\n}\r\nfunction size(object) {\r\n    return Object.keys(object).length;\r\n}\r\nfunction find(target, callback) {\r\n    var list = target;\r\n    // Makes sures is always has an positive integer as length.\r\n    var length = list.length >>> 0;\r\n    var thisArg = arguments[1];\r\n    for (var i = 0; i < length; i++) {\r\n        var element = list[i];\r\n        if (callback.call(thisArg, element, i, list)) {\r\n            return element;\r\n        }\r\n    }\r\n}\r\nvar sessionStorageKey = 'builderSessionId';\r\nvar isBrowser = typeof window !== 'undefined' && !isReactNative;\r\nvar isIframe = isBrowser && window.top !== window.self;\r\nfunction BuilderComponent(info) {\r\n    if (info === void 0) { info = {}; }\r\n    return Builder.Component(info);\r\n}\r\nvar Builder = /** @class */ (function () {\r\n    function Builder(apiKey, request, response, forceNewInstance) {\r\n        var _this = this;\r\n        if (apiKey === void 0) { apiKey = null; }\r\n        if (forceNewInstance === void 0) { forceNewInstance = false; }\r\n        this.request = request;\r\n        this.response = response;\r\n        this.authToken = '';\r\n        this.eventsQueue = [];\r\n        this.throttledClearEventsQueue = throttle(function () {\r\n            _this.processEventsQueue();\r\n        }, 100);\r\n        this.env = 'production';\r\n        this.isUsed = false;\r\n        this.sessionId = this.getSessionId();\r\n        this.targetContent = true;\r\n        this.cookies = null;\r\n        // TODO: api options object\r\n        this.cachebust = false;\r\n        this.overrideParams = '';\r\n        this.noCache = false;\r\n        this.overrideHost = '';\r\n        this.preview = false;\r\n        this.canTrack$ = new BehaviorSubject(!this.browserTrackingDisabled);\r\n        this.apiKey$ = new BehaviorSubject(null);\r\n        this.editingMode$ = new BehaviorSubject(isIframe);\r\n        // TODO: decorator to do this stuff with the get/set (how do with typing too? compiler?)\r\n        this.editingModel$ = new BehaviorSubject(null);\r\n        this.userAgent = (typeof navigator === 'object' && navigator.userAgent) || '';\r\n        this.autoTrack = !Builder.isBrowser\r\n            ? false\r\n            : !this.isDevelopmentEnv &&\r\n                !(Builder.isBrowser && location.search.indexOf('builder.preview=') !== -1);\r\n        this.useNewContentApi = false;\r\n        this.blockContentLoading = '';\r\n        this.observersByKey = {};\r\n        this.overrides = {};\r\n        this.getContentQueue = null;\r\n        this.priorContentQueue = null;\r\n        this.testCookiePrefix = 'builder.tests';\r\n        this.cookieQueue = [];\r\n        // TODO: use a window variable for this perhaps, e.g. bc webcomponents may be loading builder twice\r\n        // with it's and react (use rollup build to fix)\r\n        if (Builder.isBrowser && !forceNewInstance && Builder.singletonInstance) {\r\n            return Builder.singletonInstance;\r\n        }\r\n        if (this.request && this.response) {\r\n            this.setUserAgent(this.request.headers['user-agent'] || '');\r\n            this.cookies = new Cookies(this.request, this.response);\r\n        }\r\n        if (apiKey) {\r\n            this.apiKey = apiKey;\r\n        }\r\n        if (isBrowser) {\r\n            this.bindMessageListeners();\r\n            // TODO: postmessage to parent the builder info for every package\r\n            // type: 'builder.sdk', data: { name: '@builder.io/react', version: '0.1.23' }\r\n            // (window as any).BUILDER_VERSION = Builder.VERSION;\r\n            // Ensure always one Builder global singleton\r\n            // TODO: some people won't want this, e.g. rakuten\r\n            // Maybe hide this behind symbol or on document, etc\r\n            // if ((window as any).Builder) {\r\n            //   Builder.components = (window as any).Builder.components;\r\n            // } else {\r\n            //   (window as any).Builder = Builder;\r\n            // }\r\n        }\r\n        if (isIframe) {\r\n            this.messageFrameLoaded();\r\n        }\r\n        // TODO: on destroy clear subscription\r\n        this.canTrack$.subscribe(function (value) {\r\n            if (value) {\r\n                if (typeof sessionStorage !== 'undefined') {\r\n                    try {\r\n                        if (!sessionStorage.getItem(sessionStorageKey)) {\r\n                            sessionStorage.setItem(sessionStorageKey, _this.sessionId);\r\n                        }\r\n                    }\r\n                    catch (err) {\r\n                        console.debug('Session storage error', err);\r\n                    }\r\n                }\r\n                if (_this.eventsQueue.length) {\r\n                    _this.throttledClearEventsQueue();\r\n                }\r\n                if (_this.cookieQueue.length) {\r\n                    _this.cookieQueue.forEach(function (item) {\r\n                        _this.setCookie(item[0], item[1]);\r\n                    });\r\n                    _this.cookieQueue.length = 0;\r\n                }\r\n            }\r\n        });\r\n        if (isBrowser) {\r\n            // TODO: defer so subclass constructor runs and injects location service\r\n            this.setTestsFromUrl();\r\n            // TODO: do this on every request send?\r\n            this.getOverridesFromQueryString();\r\n        }\r\n    }\r\n    Builder.register = function (type, info) {\r\n        // TODO: all must have name and can't conflict?\r\n        var typeList = this.registry[type];\r\n        if (!typeList) {\r\n            typeList = this.registry[type] = [];\r\n        }\r\n        typeList.push(info);\r\n        if (Builder.isBrowser) {\r\n            var message = {\r\n                type: 'builder.register',\r\n                data: {\r\n                    type: type,\r\n                    info: info,\r\n                },\r\n            };\r\n            parent.postMessage(message, '*');\r\n            if (parent !== window) {\r\n                window.postMessage(message, '*');\r\n            }\r\n        }\r\n        this.registryChange.next(this.registry);\r\n    };\r\n    Builder.registerEditor = function (info) {\r\n        if (Builder.isBrowser) {\r\n            window.postMessage({\r\n                type: 'builder.registerEditor',\r\n                data: omit(info, 'component'),\r\n            }, '*');\r\n            var host = location.host;\r\n            if (!(host === 'localhost:1234' || host.indexOf('builder.io') !== -1)) {\r\n                console.error('Builder.registerEditor() called in the wrong environment! You cannot load custom editors from your app, they must be loaded through the Builder.io app itself. Follow the readme here for more details: https://github.com/builderio/builder/tree/master/plugins/cloudinary or contact chat us in our Spectrum community for help: https://spectrum.chat/builder');\r\n            }\r\n        }\r\n        this.editors.push(info);\r\n    };\r\n    Builder.registerPlugin = function (info) {\r\n        this.plugins.push(info);\r\n    };\r\n    Builder.registerAction = function (action) {\r\n        this.actions.push(action);\r\n    };\r\n    Builder.runAction = function (action) {\r\n        // TODO\r\n        var actionObject = typeof action === 'string' ? find(this.actions, function (item) { return item.name === action; }) : action;\r\n        if (!actionObject) {\r\n            throw new Error(\"Action not found: \" + action);\r\n        }\r\n    };\r\n    Builder.fields = function (name$$1, fields) {\r\n        var _a;\r\n        (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n            type: 'builder.fields',\r\n            data: { name: name$$1, fields: fields },\r\n        }, '*');\r\n    };\r\n    Builder.import = function (packageName) {\r\n        if (!Builder.isBrowser) {\r\n            // TODO: server side support *maybe*\r\n            console.warn('Builder.import used on the server - this should only be used in the browser');\r\n            return;\r\n        }\r\n        var System = window.System;\r\n        if (!System) {\r\n            console.warn('System.js not available. Please include System.js when using Builder.import');\r\n            return;\r\n        }\r\n        return System.import(\"https://cdn.builder.io/systemjs/\" + packageName);\r\n    };\r\n    Object.defineProperty(Builder, \"editingPage\", {\r\n        // useCdnApi = false;\r\n        get: function () {\r\n            return this._editingPage;\r\n        },\r\n        set: function (editingPage) {\r\n            this._editingPage = editingPage;\r\n            if (isBrowser && isIframe) {\r\n                if (editingPage) {\r\n                    document.body.classList.add('builder-editing-page');\r\n                }\r\n                else {\r\n                    document.body.classList.remove('builder-editing-page');\r\n                }\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prepareComponentSpecToSend = function (spec) {\r\n        return __assign(__assign(__assign({}, spec), (spec.inputs && {\r\n            inputs: spec.inputs.map(function (input) {\r\n                var _a;\r\n                // TODO: do for nexted fields too\r\n                // TODO: probably just convert all functions, not just\r\n                // TODO: put this in input hooks: { onChange: ..., showIf: ... }\r\n                var keysToConvertFnToString = ['onChange', 'showIf'];\r\n                for (var _i = 0, keysToConvertFnToString_1 = keysToConvertFnToString; _i < keysToConvertFnToString_1.length; _i++) {\r\n                    var key = keysToConvertFnToString_1[_i];\r\n                    if (input[key] && typeof input[key] === 'function') {\r\n                        var fn = input[key];\r\n                        input = __assign(__assign({}, input), (_a = {}, _a[key] = \"return (\" + fn.toString() + \").apply(this, arguments)\", _a));\r\n                    }\r\n                }\r\n                return input;\r\n            }),\r\n        })), { hooks: Object.keys(spec.hooks || {}).reduce(function (memo, key) {\r\n                var value = spec.hooks && spec.hooks[key];\r\n                if (!value) {\r\n                    return memo;\r\n                }\r\n                if (typeof value === 'string') {\r\n                    memo[key] = value;\r\n                }\r\n                else {\r\n                    memo[key] = \"return (\" + value.toString() + \").apply(this, arguments)\";\r\n                }\r\n                return memo;\r\n            }, {}), class: undefined });\r\n    };\r\n    // static registerComponent(...) { .. }\r\n    Builder.registerComponent = function (component, options) {\r\n        var _a;\r\n        var spec = __assign({ class: component }, options);\r\n        this.addComponent(spec);\r\n        if (isBrowser) {\r\n            var sendSpec = this.prepareComponentSpecToSend(spec);\r\n            (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n                type: 'builder.registerComponent',\r\n                data: sendSpec,\r\n            }, '*');\r\n        }\r\n    };\r\n    Builder.addComponent = function (component) {\r\n        var current = find(this.components, function (item) { return item.name === component.name; });\r\n        if (current) {\r\n            // FIXME: why does sometimes we get an extra post without class - probably\r\n            // from postMessage handler wrong in some place\r\n            if (current.class && !component.class) {\r\n                return;\r\n            }\r\n            this.components.splice(this.components.indexOf(current), 1, component);\r\n        }\r\n        else {\r\n            this.components.push(component);\r\n        }\r\n    };\r\n    // TODO: style guide, etc off this system as well?\r\n    Builder.component = function (info) {\r\n        var _this = this;\r\n        if (info === void 0) { info = {}; }\r\n        return function (component) {\r\n            var _a;\r\n            var spec = __assign(__assign({}, info), { class: component });\r\n            if (!spec.name) {\r\n                spec.name = component.name;\r\n            }\r\n            _this.addComponent(spec);\r\n            var sendSpec = _this.prepareComponentSpecToSend(spec);\r\n            // TODO: serialize component name and inputs\r\n            if (isBrowser) {\r\n                (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n                    type: 'builder.registerComponent',\r\n                    data: sendSpec,\r\n                }, '*');\r\n            }\r\n            return component;\r\n        };\r\n    };\r\n    Object.defineProperty(Builder, \"Component\", {\r\n        get: function () {\r\n            return this.component;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prototype.processEventsQueue = function () {\r\n        if (!this.eventsQueue.length) {\r\n            return;\r\n        }\r\n        var events = this.eventsQueue;\r\n        this.eventsQueue = [];\r\n        var host = this.host.replace('cdn.builder.io', 'builder.io');\r\n        fetch(host + \"/api/v1/track\", {\r\n            method: 'POST',\r\n            body: JSON.stringify({ events: events }),\r\n            headers: {\r\n                'content-type': 'application/json',\r\n            },\r\n            mode: 'cors',\r\n        });\r\n    };\r\n    Object.defineProperty(Builder.prototype, \"browserTrackingDisabled\", {\r\n        get: function () {\r\n            return Builder.isBrowser && navigator.doNotTrack === '1';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Builder.prototype, \"canTrack\", {\r\n        get: function () {\r\n            return this.canTrack$.value && !this.browserTrackingDisabled;\r\n        },\r\n        set: function (canTrack) {\r\n            if (this.canTrack !== canTrack) {\r\n                this.canTrack$.next(canTrack);\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Builder.prototype, \"editingMode\", {\r\n        get: function () {\r\n            return this.editingMode$.value;\r\n        },\r\n        set: function (value) {\r\n            if (value !== this.editingMode) {\r\n                this.editingMode$.next(value);\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Builder.prototype, \"editingModel\", {\r\n        get: function () {\r\n            return this.editingModel$.value;\r\n        },\r\n        set: function (value) {\r\n            if (value !== this.editingModel) {\r\n                this.editingModel$.next(value);\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prototype.findParentElement = function (target, callback, checkElement) {\r\n        if (checkElement === void 0) { checkElement = true; }\r\n        if (!(target instanceof HTMLElement)) {\r\n            return null;\r\n        }\r\n        var parent = checkElement ? target : target.parentElement;\r\n        do {\r\n            if (!parent) {\r\n                return null;\r\n            }\r\n            var matches = callback(parent);\r\n            if (matches) {\r\n                return parent;\r\n            }\r\n        } while ((parent = parent.parentElement));\r\n        return null;\r\n    };\r\n    Builder.prototype.findBuilderParent = function (target) {\r\n        return this.findParentElement(target, function (el) {\r\n            var id = el.getAttribute('builder-id') || el.id;\r\n            return Boolean(id && id.indexOf('builder-') === 0);\r\n        });\r\n    };\r\n    Builder.prototype.setUserAgent = function (userAgent) {\r\n        this.userAgent = userAgent || '';\r\n    };\r\n    Builder.prototype.track = function (eventName, properties) {\r\n        if (properties === void 0) { properties = {}; }\r\n        // TODO: queue up track requests and fire them off when canTrack set to true - otherwise may get lots of clicks with no impressions\r\n        if (isIframe || !isBrowser) {\r\n            return;\r\n        }\r\n        // batch events\r\n        this.eventsQueue.push({\r\n            type: eventName,\r\n            data: __assign(__assign({}, omit(properties, 'meta')), { metadata: __assign(__assign({ sdkVersion: Builder.VERSION, url: location.href }, properties.meta), properties.metadata), ownerId: this.apiKey, userAttributes: this.getUserAttributes(), sessionId: this.sessionId }),\r\n        });\r\n        if (this.canTrack) {\r\n            this.throttledClearEventsQueue();\r\n        }\r\n    };\r\n    Builder.prototype.getSessionId = function () {\r\n        var _this = this;\r\n        var sessionId = null;\r\n        try {\r\n            // TODO: don't set this until gdpr allowed....\r\n            if (Builder.isBrowser && typeof sessionStorage !== 'undefined') {\r\n                sessionStorage.getItem(sessionStorageKey);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.debug('Session storage error', err);\r\n            // It's ok\r\n        }\r\n        if (!sessionId) {\r\n            sessionId = (Date.now() + Math.random()).toString(36);\r\n        }\r\n        // Give the app a second to start up and set canTrack to false if needed\r\n        if (Builder.isBrowser) {\r\n            setTimeout(function () {\r\n                if (_this.canTrack && typeof sessionStorage !== 'undefined' && sessionId) {\r\n                    try {\r\n                        sessionStorage.setItem(sessionStorageKey, sessionId);\r\n                    }\r\n                    catch (err) {\r\n                        console.debug('Session storage error', err);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        return sessionId;\r\n    };\r\n    Builder.prototype.trackImpression = function (contentId, variationId) {\r\n        if (isIframe || !isBrowser) {\r\n            return;\r\n        }\r\n        // TODO: use this.track method\r\n        this.eventsQueue.push({\r\n            type: 'impression',\r\n            data: {\r\n                contentId: contentId,\r\n                variationId: variationId !== contentId ? variationId : undefined,\r\n                ownerId: this.apiKey,\r\n                userAttributes: this.getUserAttributes(),\r\n                sessionId: this.sessionId,\r\n            },\r\n        });\r\n        this.throttledClearEventsQueue();\r\n    };\r\n    // Multiple content IDs?\r\n    Builder.prototype.trackConversion = function (amount, contentId) {\r\n        if (isIframe || !isBrowser) {\r\n            return;\r\n        }\r\n        // TODO: use this.track method\r\n        this.eventsQueue.push({\r\n            type: 'conversion',\r\n            data: {\r\n                // contentId,\r\n                // variationId: variationId !== contentId ? variationId : undefined,\r\n                amount: amount,\r\n                ownerId: this.apiKey,\r\n                userAttributes: this.getUserAttributes(),\r\n                sessionId: this.sessionId,\r\n            },\r\n        });\r\n        this.throttledClearEventsQueue();\r\n    };\r\n    Object.defineProperty(Builder.prototype, \"isDevelopmentEnv\", {\r\n        // TODO: set this for QA\r\n        get: function () {\r\n            // Automatic determining of development environment\r\n            return (Builder.isIframe ||\r\n                (Builder.isBrowser && (location.hostname === 'localhost' || location.port !== '')) ||\r\n                this.env !== 'production');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prototype.trackInteraction = function (contentId, variationId, alreadyTrackedOne, event) {\r\n        if (alreadyTrackedOne === void 0) { alreadyTrackedOne = false; }\r\n        if (isIframe || !isBrowser) {\r\n            return;\r\n        }\r\n        var target = event && event.target;\r\n        var targetBuilderElement = target && this.findBuilderParent(target);\r\n        function round(num) {\r\n            return Math.round(num * 1000) / 1000;\r\n        }\r\n        var metadata = {};\r\n        if (event) {\r\n            var clientX = event.clientX, clientY = event.clientY;\r\n            if (target) {\r\n                var targetRect = target.getBoundingClientRect();\r\n                var xOffset = clientX - targetRect.left;\r\n                var yOffset = clientY - targetRect.top;\r\n                var xRatio = round(xOffset / targetRect.width);\r\n                var yRatio = round(yOffset / targetRect.height);\r\n                metadata.targetOffset = {\r\n                    x: xRatio,\r\n                    y: yRatio,\r\n                };\r\n            }\r\n            if (targetBuilderElement) {\r\n                var targetRect = targetBuilderElement.getBoundingClientRect();\r\n                var xOffset = clientX - targetRect.left;\r\n                var yOffset = clientY - targetRect.top;\r\n                var xRatio = round(xOffset / targetRect.width);\r\n                var yRatio = round(yOffset / targetRect.height);\r\n                metadata.builderTargetOffset = {\r\n                    x: xRatio,\r\n                    y: yRatio,\r\n                };\r\n            }\r\n        }\r\n        // let selector: string | undefined = undefined;\r\n        // if (target) {\r\n        //   try {\r\n        //     selector = finder(target);\r\n        //   } catch (err) {\r\n        //     // nbd\r\n        //   }\r\n        // }\r\n        var builderId = targetBuilderElement &&\r\n            (targetBuilderElement.getAttribute('builder-id') || targetBuilderElement.id);\r\n        if (builderId && targetBuilderElement) {\r\n            metadata.builderElementIndex = [].slice\r\n                .call(document.getElementsByClassName(builderId))\r\n                .indexOf(targetBuilderElement);\r\n        }\r\n        // TODO: use this.track method\r\n        this.eventsQueue.push({\r\n            type: 'click',\r\n            data: {\r\n                contentId: contentId,\r\n                metadata: metadata,\r\n                variationId: variationId !== contentId ? variationId : undefined,\r\n                ownerId: this.apiKey,\r\n                unique: !alreadyTrackedOne,\r\n                // targetSelector: selector,\r\n                targetBuilderElement: builderId || undefined,\r\n                userAttributes: this.getUserAttributes(),\r\n                sessionId: this.sessionId,\r\n            },\r\n        });\r\n        this.throttledClearEventsQueue();\r\n    };\r\n    Builder.prototype.component = function (info) {\r\n        if (info === void 0) { info = {}; }\r\n        return Builder.component(info);\r\n    };\r\n    Object.defineProperty(Builder.prototype, \"apiKey\", {\r\n        get: function () {\r\n            return this.apiKey$.value;\r\n        },\r\n        set: function (key) {\r\n            this.apiKey$.next(key);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prototype.modifySearch = function (search) {\r\n        return search.replace(/(^|&|\\?)(builder_.*?)=/gi, function (_match, group1, group2) { return group1 + group2.replace(/_/g, '.') + '='; });\r\n    };\r\n    Builder.prototype.setTestsFromUrl = function () {\r\n        var search = this.getLocation().search;\r\n        var params = QueryString.parseDeep(this.modifySearch(search || '').substr(1));\r\n        var tests = params.builder && params.builder.tests;\r\n        if (tests && typeof tests === 'object') {\r\n            for (var key in tests) {\r\n                if (tests.hasOwnProperty(key)) {\r\n                    this.setTestCookie(key, tests[key]);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Builder.prototype.resetOverrides = function () {\r\n        // Ugly - pass down instances per request instead using react context\r\n        // or use builder.get('foo', { req, res }) in react...........\r\n        Builder.overrideUserAttributes = {};\r\n        this.cachebust = false;\r\n        this.noCache = false;\r\n        this.preview = false;\r\n        this.overrideHost = '';\r\n        this.editingModel = null;\r\n        this.overrides = {};\r\n        this.env = 'production';\r\n        this.userAgent = '';\r\n        this.request = undefined;\r\n        this.response = undefined;\r\n    };\r\n    Builder.prototype.getOverridesFromQueryString = function () {\r\n        var location = this.getLocation();\r\n        var params = QueryString.parseDeep(this.modifySearch(location.search || '').substr(1));\r\n        var builder = params.builder;\r\n        if (builder) {\r\n            var userAttributes = builder.userAttributes, overrides = builder.overrides, env = builder.env, host = builder.host, api = builder.api, cachebust = builder.cachebust, noCache = builder.noCache, preview = builder.preview, editing = builder.editing, frameEditing = builder.frameEditing, overrideParams = builder.params;\r\n            if (userAttributes) {\r\n                this.setUserAttributes(userAttributes);\r\n            }\r\n            if (overrides) {\r\n                this.overrides = overrides;\r\n            }\r\n            if (env || api) {\r\n                this.env = env || api;\r\n            }\r\n            if (Builder.isEditing) {\r\n                var editingModel = frameEditing || editing || preview;\r\n                if (editingModel && editingModel !== 'true') {\r\n                    this.editingModel = editingModel;\r\n                }\r\n            }\r\n            if (host) {\r\n                this.overrideHost = host;\r\n            }\r\n            if (cachebust) {\r\n                this.cachebust = true;\r\n            }\r\n            if (noCache) {\r\n                this.noCache = true;\r\n            }\r\n            if (preview) {\r\n                this.preview = true;\r\n            }\r\n            if (params) {\r\n                this.overrideParams = overrideParams;\r\n            }\r\n        }\r\n    };\r\n    Builder.prototype.messageFrameLoaded = function () {\r\n        var _a;\r\n        (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n            type: 'builder.loaded',\r\n            data: {\r\n                value: true,\r\n            },\r\n        }, '*');\r\n    };\r\n    Builder.prototype.bindMessageListeners = function () {\r\n        var _this = this;\r\n        if (isBrowser) {\r\n            addEventListener('message', function (event) {\r\n                var _a, _b, _c, _d;\r\n                var url = parse(event.origin);\r\n                if (!(url.hostname &&\r\n                    (url.hostname === 'builder.io' ||\r\n                        url.hostname.endsWith('.builder.io') ||\r\n                        url.hostname === 'localhost'))) {\r\n                    return;\r\n                }\r\n                var data = event.data;\r\n                if (data) {\r\n                    switch (data.type) {\r\n                        case 'builder.ping': {\r\n                            (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n                                type: 'builder.pong',\r\n                                data: {},\r\n                            }, '*');\r\n                            break;\r\n                        }\r\n                        case 'builder.registerEditor': {\r\n                            // TODO: possibly do this for all...\r\n                            if (event.source === window) {\r\n                                break;\r\n                            }\r\n                            var info_1 = data.data;\r\n                            if (!info_1) {\r\n                                break;\r\n                            }\r\n                            var hasComponent_1 = !!info_1.component;\r\n                            Builder.editors.every(function (thisInfo, index) {\r\n                                if (info_1.name === thisInfo.name) {\r\n                                    if (thisInfo.component && !hasComponent_1) {\r\n                                        return false;\r\n                                    }\r\n                                    else {\r\n                                        Builder.editors[index] = thisInfo;\r\n                                    }\r\n                                    return false;\r\n                                }\r\n                                return true;\r\n                            });\r\n                            break;\r\n                        }\r\n                        case 'builder.triggerAnimation': {\r\n                            Builder.animator.triggerAnimation(data.data);\r\n                            break;\r\n                        }\r\n                        case 'builder.contentUpdate':\r\n                            var key = data.data.key || data.data.alias || data.data.entry || data.data.modelName;\r\n                            var contentData = data.data.data; // hmmm...\r\n                            var observer = _this.observersByKey[key];\r\n                            if (observer) {\r\n                                observer.next([contentData]);\r\n                            }\r\n                            break;\r\n                        case 'builder.getComponents':\r\n                            (_b = window.parent) === null || _b === void 0 ? void 0 : _b.postMessage({\r\n                                type: 'builder.components',\r\n                                data: Builder.components.map(function (item) { return Builder.prepareComponentSpecToSend(item); }),\r\n                            }, '*');\r\n                            break;\r\n                        case 'builder.editingModel':\r\n                            _this.editingModel = data.data.model;\r\n                            break;\r\n                        case 'builder.registerComponent':\r\n                            var componentData = data.data;\r\n                            Builder.addComponent(componentData);\r\n                            break;\r\n                        case 'builder.blockContentLoading':\r\n                            if (typeof data.data.model === 'string') {\r\n                                _this.blockContentLoading = data.data.model;\r\n                            }\r\n                            break;\r\n                        case 'builder.editingMode':\r\n                            var editingMode = data.data;\r\n                            if (editingMode) {\r\n                                _this.editingMode = true;\r\n                                document.body.classList.add('builder-editing');\r\n                            }\r\n                            else {\r\n                                _this.editingMode = false;\r\n                                document.body.classList.remove('builder-editing');\r\n                            }\r\n                            break;\r\n                        case 'builder.editingPageMode':\r\n                            var editingPageMode = data.data;\r\n                            Builder.editingPage = editingPageMode;\r\n                            break;\r\n                        case 'builder.overrideUserAttributes':\r\n                            var userAttributes = data.data;\r\n                            assign(Builder.overrideUserAttributes, userAttributes);\r\n                            _this.flushGetContentQueue(true);\r\n                            // TODO: refetch too\r\n                            break;\r\n                        case 'builder.overrideTestGroup':\r\n                            var _e = data.data, variationId = _e.variationId, contentId = _e.contentId;\r\n                            if (variationId && contentId) {\r\n                                _this.setTestCookie(contentId, variationId);\r\n                                _this.flushGetContentQueue(true);\r\n                            }\r\n                            break;\r\n                        case 'builder.evaluate': {\r\n                            var text = data.data.text;\r\n                            var args = data.data.arguments || [];\r\n                            var id_1 = data.data.id;\r\n                            // tslint:disable-next-line:no-function-constructor-with-string-args\r\n                            var fn = new Function(text);\r\n                            var result = void 0;\r\n                            var error = null;\r\n                            try {\r\n                                result = fn.apply(_this, args);\r\n                            }\r\n                            catch (err) {\r\n                                error = err;\r\n                            }\r\n                            if (error) {\r\n                                (_c = window.parent) === null || _c === void 0 ? void 0 : _c.postMessage({\r\n                                    type: 'builder.evaluateError',\r\n                                    data: { id: id_1, error: error.message },\r\n                                }, '*');\r\n                            }\r\n                            else {\r\n                                if (result && typeof result.then === 'function') {\r\n                                    result\r\n                                        .then(function (finalResult) {\r\n                                        var _a;\r\n                                        (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({\r\n                                            type: 'builder.evaluateResult',\r\n                                            data: { id: id_1, result: finalResult },\r\n                                        }, '*');\r\n                                    })\r\n                                        .catch(console.error);\r\n                                }\r\n                                else {\r\n                                    (_d = window.parent) === null || _d === void 0 ? void 0 : _d.postMessage({\r\n                                        type: 'builder.evaluateResult',\r\n                                        data: { result: result, id: id_1 },\r\n                                    }, '*');\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Builder.prototype.init = function (apiKey, canTrack, req, res) {\r\n        if (canTrack === void 0) { canTrack = true; }\r\n        if (req) {\r\n            this.request = req;\r\n        }\r\n        if (res) {\r\n            this.response = res;\r\n        }\r\n        this.canTrack = canTrack;\r\n        this.apiKey = apiKey;\r\n        return this;\r\n    };\r\n    // TODO: allow adding location object as property and/or in constructor\r\n    Builder.prototype.getLocation = function () {\r\n        var parsedLocation = {};\r\n        // in ssr mode\r\n        if (this.request) {\r\n            parsedLocation = parse(this.request.url);\r\n        }\r\n        // in the browser\r\n        if (typeof location === 'object') {\r\n            parsedLocation = parse(location.href);\r\n        }\r\n        // IE11 bug with parsed path being empty string\r\n        // causes issues with our user targeting\r\n        if (parsedLocation.pathname === '') {\r\n            parsedLocation.pathname = '/';\r\n        }\r\n        return parsedLocation;\r\n    };\r\n    Builder.prototype.getUserAttributes = function (userAgent) {\r\n        if (userAgent === void 0) { userAgent = this.userAgent || ''; }\r\n        this.isUsed = true;\r\n        // TODO: detect desktop browser and OS too\r\n        // TODO: add user agent lib back\r\n        var isMobile = {\r\n            Android: function () {\r\n                return userAgent.match(/Android/i);\r\n            },\r\n            BlackBerry: function () {\r\n                return userAgent.match(/BlackBerry/i);\r\n            },\r\n            iOS: function () {\r\n                return userAgent.match(/iPhone|iPad|iPod/i);\r\n            },\r\n            Opera: function () {\r\n                return userAgent.match(/Opera Mini/i);\r\n            },\r\n            Windows: function () {\r\n                return userAgent.match(/IEMobile/i) || userAgent.match(/WPDesktop/i);\r\n            },\r\n            any: function () {\r\n                return (isMobile.Android() ||\r\n                    isMobile.BlackBerry() ||\r\n                    isMobile.iOS() ||\r\n                    isMobile.Opera() ||\r\n                    isMobile.Windows());\r\n            },\r\n        };\r\n        // FIXME\r\n        var url = this.getLocation();\r\n        // const device = ua.getDevice();\r\n        // TODO: get these from exension as well\r\n        return __assign({ \r\n            // Removing because blowing out cache keys\r\n            // queryString: url.search,\r\n            urlPath: url.pathname, \r\n            // Removinf for now because of cache keys\r\n            // referrer: document.referrer,\r\n            // language: navigator.language.split('-')[0],\r\n            host: url.host || url.hostname, device: isMobile.any() ? 'mobile' : 'desktop' }, Builder.overrideUserAttributes);\r\n    };\r\n    Builder.prototype.setUserAttributes = function (options) {\r\n        assign(Builder.overrideUserAttributes, options);\r\n    };\r\n    Builder.prototype.get = function (modelName, options) {\r\n        if (options === void 0) { options = {}; }\r\n        var instance = this;\r\n        if (!Builder.isBrowser && (options.req || options.res)) {\r\n            instance = new Builder(options.apiKey || this.apiKey, options.req, options.res);\r\n        }\r\n        else {\r\n            if (options.apiKey && !this.apiKey) {\r\n                this.apiKey = options.apiKey;\r\n            }\r\n        }\r\n        return instance.queueGetContent(modelName, options).map(\r\n        /* map( */ function (matches) {\r\n            var match = matches && matches[0];\r\n            var matchData = match && match.data;\r\n            if (!matchData) {\r\n                return null;\r\n            }\r\n            return {\r\n                // TODO: add ab test info here and other high level stuff\r\n                data: matchData,\r\n                id: match.id,\r\n                variationId: match.testVariationId || match.variationId,\r\n                testVariationId: match.testVariationId || match.variationId,\r\n                testVariationName: match.testVariationName,\r\n            };\r\n        });\r\n        // );\r\n    };\r\n    // TODO: entry id in options\r\n    Builder.prototype.queueGetContent = function (modelName, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        // TODO: if query do modelName + query\r\n        var key = options.key ||\r\n            options.alias ||\r\n            // TODO: SDKs only pass entry key when given to them, and never when editing...\r\n            // options.entry ||\r\n            // TODO: this is ugly - instead of multiple of same model with different options are sent\r\n            // say requires key/alias. Or if not perhaps make a reliable hash of the options and use that.\r\n            // TODO: store last user state on last request and if user attributes different now\r\n            // give a warning that need to use keys to request new contente\r\n            // (options &&\r\n            //   Object.keys(options).filter(key => key !== 'model').length &&\r\n            //   JSON.stringify({ model: modelName, ...options, initialContent: undefined })) ||\r\n            modelName;\r\n        var isEditingThisModel = this.editingModel === modelName;\r\n        // TODO: include params in this key........\r\n        var currentObservable = this.observersByKey[key];\r\n        // if (options.query && options.query._id) {\r\n        //   this.flushGetContentQueue([options])\r\n        // }\r\n        if (this.apiKey === 'DEMO' && !this.overrides[key] && !options.initialContent) {\r\n            options.initialContent = [];\r\n        }\r\n        var initialContent = options.initialContent;\r\n        // TODO: refresh option in options\r\n        if (currentObservable && (!currentObservable.value || options.cache)) {\r\n            // TODO: test if this ran, otherwise on 404 some observers may never be called...\r\n            if (currentObservable.value) {\r\n                nextTick(function () {\r\n                    // TODO: return a new observable and only that one fires subscribers, don't refire for existing ones\r\n                    currentObservable.next(currentObservable.value);\r\n                });\r\n            }\r\n            return currentObservable;\r\n        }\r\n        if (isEditingThisModel) {\r\n            if (Builder.isBrowser) {\r\n                parent.postMessage({ type: 'builder.updateContent' }, '*');\r\n            }\r\n        }\r\n        if (!initialContent /* || isEditingThisModel */) {\r\n            if (!this.getContentQueue) {\r\n                this.getContentQueue = [];\r\n            }\r\n            this.getContentQueue.push(__assign(__assign({}, options), { model: modelName, key: key }));\r\n            if (this.getContentQueue && this.getContentQueue.length >= 5) {\r\n                this.flushGetContentQueue();\r\n            }\r\n            else {\r\n                nextTick(function () {\r\n                    _this.flushGetContentQueue();\r\n                });\r\n            }\r\n        }\r\n        var observable = new BehaviorSubject(null);\r\n        this.observersByKey[key] = observable;\r\n        if (initialContent) {\r\n            nextTick(function () {\r\n                // TODO: need to testModify this I think...?\r\n                observable.next(initialContent);\r\n            });\r\n        }\r\n        return observable;\r\n    };\r\n    Builder.prototype.requestUrl = function (url) {\r\n        if (Builder.isBrowser) {\r\n            // TODO: send auth header if builder.authToken\r\n            return fetch(url, this.authToken\r\n                ? {\r\n                    headers: {\r\n                        Authorization: \"Bearer \" + this.authToken,\r\n                    },\r\n                }\r\n                : undefined).then(function (res) { return res.json(); });\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var module = url.indexOf('http:') === 0 ? serverOnlyRequire$1('http') : serverOnlyRequire$1('https');\r\n            module\r\n                .get(url, function (resp) {\r\n                var data = '';\r\n                // A chunk of data has been recieved.\r\n                resp.on('data', function (chunk) {\r\n                    data += chunk;\r\n                });\r\n                // The whole response has been received. Print out the result.\r\n                resp.on('end', function () {\r\n                    resolve(JSON.parse(data));\r\n                });\r\n            })\r\n                .on('error', function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(Builder.prototype, \"host\", {\r\n        get: function () {\r\n            if (this.overrideHost) {\r\n                return this.overrideHost;\r\n            }\r\n            if (this.env.includes('//')) {\r\n                return this.env;\r\n            }\r\n            if (this.env.includes('.')) {\r\n                return 'http://' + this.env;\r\n            }\r\n            switch (this.env) {\r\n                case 'qa':\r\n                    return 'https://qa.builder.io';\r\n                case 'fast':\r\n                    return 'https://fast.builder.io';\r\n                case 'cloud':\r\n                    return 'https://cloud.builder.io';\r\n                case 'cdn2':\r\n                    return 'https://cdn2.builder.io';\r\n                case 'cdn-qa':\r\n                    return 'https://cdn-qa.builder.io';\r\n                case 'development':\r\n                case 'dev':\r\n                    return 'http://localhost:5000';\r\n                default:\r\n                    return 'https://cdn.builder.io';\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Builder.prototype.flushGetContentQueue = function (usePastQueue, useQueue) {\r\n        var _this = this;\r\n        if (usePastQueue === void 0) { usePastQueue = false; }\r\n        if (!this.apiKey) {\r\n            throw new Error('Builder needs to be initialized with an API key!');\r\n        }\r\n        if (!usePastQueue && !this.getContentQueue) {\r\n            return;\r\n        }\r\n        var queue = useQueue || (usePastQueue ? this.priorContentQueue : this.getContentQueue) || [];\r\n        // TODO: do this on every request send?\r\n        this.getOverridesFromQueryString();\r\n        var queryParams = {};\r\n        var pageQueryParams = typeof location !== 'undefined'\r\n            ? QueryString.parseDeep(location.search.substr(1))\r\n            : undefined || {};\r\n        var userAttributes = \r\n        // FIXME: HACK: only checks first in queue for user attributes overrides, should check all\r\n        queue && queue[0].userAttributes\r\n            ? queue[0].userAttributes\r\n            : this.targetContent\r\n                ? this.getUserAttributes()\r\n                : {\r\n                    urlPath: this.getLocation().pathname,\r\n                };\r\n        // TODO: merge in the attribute from query string ones\r\n        // TODO: make this an option per component/request\r\n        queryParams.userAttributes = Builder.useNewApi\r\n            ? userAttributes\r\n            : JSON.stringify(userAttributes);\r\n        if (!usePastQueue && !useQueue) {\r\n            this.priorContentQueue = queue;\r\n            this.getContentQueue = null;\r\n        }\r\n        var cachebust = this.cachebust ||\r\n            isIframe ||\r\n            pageQueryParams.cachebust ||\r\n            pageQueryParams['builder.cachebust'];\r\n        if (cachebust || this.env !== 'production') {\r\n            queryParams.cachebust = true;\r\n        }\r\n        if (Builder.isEditing) {\r\n            queryParams.isEditing = true;\r\n        }\r\n        if (this.noCache || this.env !== 'production') {\r\n            queryParams.noCache = true;\r\n        }\r\n        if (size(this.overrides)) {\r\n            for (var key in this.overrides) {\r\n                if (this.overrides.hasOwnProperty(key)) {\r\n                    queryParams[\"overrides.\" + key] = this.overrides[key];\r\n                }\r\n            }\r\n        }\r\n        if (Builder.useNewApi && !Builder.isReact) {\r\n            // TODO: remove me once v1 page editors converted to v2\r\n            // queryParams.extractCss = true;\r\n            queryParams.prerender = true;\r\n        }\r\n        if (Builder.useNewApi) {\r\n            for (var _i = 0, queue_1 = queue; _i < queue_1.length; _i++) {\r\n                var options = queue_1[_i];\r\n                if (options.format) {\r\n                    queryParams.format = options.format;\r\n                }\r\n                // TODO: remove me and make permodel\r\n                if (options.static) {\r\n                    queryParams.static = options.static;\r\n                }\r\n                if (options.cachebust) {\r\n                    queryParams.cachebust = options.cachebust;\r\n                }\r\n                if (typeof options.cacheSeconds === 'number') {\r\n                    queryParams.cacheSeconds = options.cacheSeconds;\r\n                }\r\n                var properties = [\r\n                    'prerender',\r\n                    'extractCss',\r\n                    'limit',\r\n                    'offset',\r\n                    'query',\r\n                    'preview',\r\n                    'model',\r\n                    'entry',\r\n                    'rev',\r\n                    'static',\r\n                ];\r\n                for (var _a = 0, properties_1 = properties; _a < properties_1.length; _a++) {\r\n                    var key = properties_1[_a];\r\n                    var value = options[key];\r\n                    if (value !== undefined) {\r\n                        queryParams.options = queryParams.options || {};\r\n                        queryParams.options[options.key] = queryParams.options[options.key] || {};\r\n                        queryParams.options[options.key][key] = JSON.stringify(value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.preview) {\r\n            queryParams.preview = 'true';\r\n        }\r\n        var hasParams = Object.keys(queryParams).length > 0;\r\n        // TODO: option to force dev or qa api here\r\n        var host = this.useNewContentApi ? 'https://lambda.builder.codes' : this.host;\r\n        var keyNames = queue.map(function (item) { return encodeURIComponent(item.key); }).join(',');\r\n        if (this.overrideParams) {\r\n            var params = QueryString.parse(this.overrideParams);\r\n            assign(queryParams, params);\r\n        }\r\n        var queryStr = Builder.useNewApi\r\n            ? QueryString.stringifyDeep(queryParams)\r\n            : QueryString.stringify(queryParams);\r\n        var promise = this.requestUrl(host + \"/api/v1/\" + (Builder.useNewApi ? 'query' : 'content') + \"/\" + this.apiKey + \"/\" + keyNames +\r\n            (queryParams && hasParams ? \"?\" + queryStr : '')).then(function (result) {\r\n            for (var _i = 0, queue_2 = queue; _i < queue_2.length; _i++) {\r\n                var options = queue_2[_i];\r\n                var keyName = options.key;\r\n                if (options.model === _this.blockContentLoading) {\r\n                    continue;\r\n                }\r\n                var isEditingThisModel = _this.editingModel === options.model;\r\n                if (isEditingThisModel && Builder.isEditing) {\r\n                    parent.postMessage({ type: 'builder.updateContent' }, '*');\r\n                    // return;\r\n                }\r\n                var observer = _this.observersByKey[keyName];\r\n                if (!observer) {\r\n                    return;\r\n                }\r\n                var data = result[keyName];\r\n                var sorted = data; // sortBy(data, item => item.priority);\r\n                if (data) {\r\n                    var testModifiedResults = _this.processResultsForTests(sorted);\r\n                    observer.next(testModifiedResults);\r\n                }\r\n                else {\r\n                    var search = _this.getLocation().search;\r\n                    if ((search || '').includes('builder.preview=' + options.model)) {\r\n                        var previewData = {\r\n                            id: 'preview',\r\n                            name: 'Preview',\r\n                            data: {},\r\n                        };\r\n                        observer.next([previewData]);\r\n                    }\r\n                    observer.next([]);\r\n                }\r\n            }\r\n        }, function (err) {\r\n            for (var _i = 0, queue_3 = queue; _i < queue_3.length; _i++) {\r\n                var options = queue_3[_i];\r\n                var observer = _this.observersByKey[options.key];\r\n                if (!observer) {\r\n                    return;\r\n                }\r\n                observer.error(err);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    Builder.prototype.processResultsForTests = function (results) {\r\n        var _this = this;\r\n        var _a;\r\n        var mappedResults = results.map(function (item) {\r\n            if (!item.variations) {\r\n                return item;\r\n            }\r\n            var cookieValue = _this.getTestCookie(item.id);\r\n            var cookieVariation = cookieValue === item.id ? item : item.variations[cookieValue];\r\n            if (cookieVariation) {\r\n                return __assign(__assign({}, item), { data: cookieVariation.data, variationId: cookieValue, testVariationId: cookieValue, testVariationName: cookieVariation.name });\r\n            }\r\n            if (item.variations && size(item.variations)) {\r\n                var n = 0;\r\n                var random = Math.random();\r\n                for (var id in item.variations) {\r\n                    var variation = item.variations[id];\r\n                    var testRatio = variation.testRatio;\r\n                    n += testRatio;\r\n                    if (random < n) {\r\n                        _this.setTestCookie(item.id, variation.id);\r\n                        return __assign(__assign({}, item), { data: variation.data, variationId: variation.id, testVariationId: variation.id, testVariationName: variation.name });\r\n                    }\r\n                }\r\n                _this.setTestCookie(item.id, item.id);\r\n            }\r\n            return __assign(__assign(__assign({}, item), { variationId: item.id }), (item.variations &&\r\n                size(item.variations) && {\r\n                testVariationId: item.id,\r\n                testVariationName: 'default',\r\n            }));\r\n        });\r\n        if (isIframe) {\r\n            (_a = window.parent) === null || _a === void 0 ? void 0 : _a.postMessage({ type: 'builder.contentResults', data: { results: mappedResults } }, '*');\r\n        }\r\n        return mappedResults;\r\n    };\r\n    Builder.prototype.getTestCookie = function (contentId) {\r\n        return this.getCookie(this.testCookiePrefix + \".\" + contentId);\r\n    };\r\n    Builder.prototype.setTestCookie = function (contentId, variationId) {\r\n        if (!this.canTrack) {\r\n            this.cookieQueue.push([contentId, variationId]);\r\n            return;\r\n        }\r\n        // 30 days from now\r\n        var future = new Date();\r\n        future.setDate(future.getDate() + 30);\r\n        return this.setCookie(this.testCookiePrefix + \".\" + contentId, variationId, future);\r\n    };\r\n    Builder.prototype.getCookie = function (name$$1) {\r\n        if (this.cookies) {\r\n            return this.cookies.get(name$$1);\r\n        }\r\n        return Builder.isBrowser && getCookie(name$$1);\r\n    };\r\n    Builder.prototype.setCookie = function (name$$1, value, expires) {\r\n        if (this.cookies) {\r\n            return this.cookies.set(name$$1, value, {\r\n                expires: expires,\r\n                secure: this.getLocation().protocol === 'https:',\r\n            });\r\n        }\r\n        return Builder.isBrowser && setCookie(name$$1, value, expires);\r\n    };\r\n    Builder.prototype.getContent = function (modelName, options) {\r\n        if (options === void 0) { options = {}; }\r\n        if (!this.apiKey) {\r\n            throw new Error('Builder needs to be initialized with an API key!');\r\n        }\r\n        return this.queueGetContent(modelName);\r\n    };\r\n    Builder.components = [];\r\n    Builder.nextTick = nextTick;\r\n    Builder.VERSION = version;\r\n    Builder.useNewApi = true;\r\n    Builder.animator = new Animator();\r\n    Builder.throttle = throttle;\r\n    Builder.editors = [];\r\n    Builder.plugins = [];\r\n    Builder.actions = [];\r\n    Builder.registry = {};\r\n    Builder.registryChange = new BehaviorSubject({});\r\n    Builder._editingPage = false;\r\n    Builder.isIframe = isIframe;\r\n    Builder.isBrowser = isBrowser;\r\n    Builder.isReactNative = isReactNative;\r\n    Builder.isServer = !isBrowser && !isReactNative;\r\n    // TODO: this is quick and dirty, do better implementation later. Also can be unreliable\r\n    // if page 301s etc. Use a query param instead? also could have issues with redirects. Injecting var could\r\n    // work but is async...\r\n    Builder.isEditing = Boolean(isIframe &&\r\n        ((document.referrer && document.referrer.match(/builder\\.io|localhost:1234/)) ||\r\n            location.search.indexOf('builder.frameEditing=') !== -1));\r\n    Builder.isReact = false;\r\n    Builder.overrideUserAttributes = {};\r\n    return Builder;\r\n}());\n\nvar builder = new Builder(null, undefined, undefined, true);\r\nBuilder.singletonInstance = builder;\n\n// import 'promise-polyfill/src/polyfill';\n\nexport { Builder, BuilderComponent, isBrowser, BehaviorSubject, Subscription, builder };\n//# sourceMappingURL=index.esm.js.map\n","import { builder } from '@builder.io/sdk';\nimport { Checkout } from './interfaces/checkout';\n\nconst TRACKED_KEY = 'builder.tracked';\n\nfunction getQueryParam(url: string, variable: string): string | null {\n  const query = url.split('?')[1] || '';\n  const vars = query.split('&');\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (decodeURIComponent(pair[0]) === variable) {\n      return decodeURIComponent(pair[1]);\n    }\n  }\n  return null;\n}\n\nconst _window = window as any;\n\nif (!_window[TRACKED_KEY]) {\n  const apiKey =\n    getQueryParam((document.currentScript as HTMLScriptElement).src || '', 'apiKey') ||\n    builder.apiKey;\n\n  if (apiKey && !builder.apiKey) {\n    builder.apiKey = apiKey;\n  }\n\n  const { Shopify } = _window;\n\n  if (!apiKey) {\n    console.debug('No apiKey for Builder JS', document.currentScript);\n  } else if (!Shopify) {\n    console.debug('No Shopify object');\n  } else {\n    _window[TRACKED_KEY] = true;\n    const checkout: Checkout | null = Shopify.checkout;\n    if (checkout) {\n      builder.track('checkout', {\n        meta: checkout,\n        amount: parseFloat(checkout.payment_due),\n      });\n      for (const item of checkout.line_items) {\n        const id = item.id;\n        const cookieValue = builder.getCookie('builder.addToCart.' + id);\n        if (cookieValue) {\n          builder.setCookie('builder.addToCart.' + id, '', new Date(0));\n          const [contentId, variationId] = cookieValue.split(',');\n          builder.track('conversion', {\n            contentId,\n            variationId,\n            meta: item,\n            amount: parseFloat(item.price), // x item.quantity?\n          });\n        }\n      }\n    }\n  }\n}\n"],"names":["isSafari","window","test","navigator","userAgent","nextTick","fn","setImmediate","MutationObserver","setTimeout","called","observer","element","document","createTextNode","observe","characterData","data","String","QueryString","parseDeep","queryString","obj","this","parse","deepen","stringifyDeep","map","flatten","stringify","query","pairs","substr","split","i","length","pair","decodeURIComponent","str","key","hasOwnProperty","value","encodeURIComponent","output","k","t","parts","pop","part","shift","_current","_res","newKey","version","Subscription","listeners","listener","unsubscribed","otherSubscriptions","prototype","add","subscription","push","unsubscribe","index","indexOf","splice","forEach","sub","BehaviorSubject","errorListeners","next","_i","_a","newSubject","subscribe","val","catch","err","error","errorListener","toPromise","_this","Promise","resolve","reject","promise","State","Pending","Fulfilled","Rejected","isFunction","isObject","TinyPromise","executor","_state","_handlers","_value","_resolve","bind","_reject","x","then","called_1","thenable","call","result","_fulfill","ex","handler","_callHandler","_isPending","_isFulfilled","_isRejected","_addHandler","onFulfilled","onRejected","Promise$1","serverOnlyRequire","eval","serverOnlyRequire$1","promiseResolve","tinyFetch","url","options","request","XMLHttpRequest","open","method","headers","setRequestHeader","response","keys","all","header","undefined","getAllResponseHeaders","replace","_match","_key","toLowerCase","ok","status","statusText","responseURL","clone","text","responseText","json","JSON","blob","Blob","entries","get","n","has","withCredentials","credentials","onload","onerror","send","body","fetch","global","assign","target","args","arguments","to","Object","nextSource","nextKey","throttle","func","wait","context","timeout","previous","later","leading","Date","now","apply","remaining","clearTimeout","trailing","camelCaseToKebabCase","g","Animator","bindAnimations","animations","animations_1","animation","trigger","triggerAnimation","bindHoverAnimation","bindScrollInViewAnimation","warnElementNotPresent","id","console","warn","augmentAnimation","stylesUsed","getAllStylesUsed","computedStyle","getComputedStyle","bothStyles_1","steps","styles","stylesUsed_1","style","properties","step","elements","Array","slice","getElementsByClassName","elementId","from","transition","transitionDelay","duration","easing","delay","defaultState","hoverState","attachDefaultState","addEventListener","triggered","immediateOnScroll","rect","windowHeight","threshold","getBoundingClientRect","innerHeight","bottom","top","removeEventListener","onScroll","capture","passive","fieldContentRegExp","Cookies","name","match","getPattern","set","opts","res","req","getHeader","secure","protocol","connection","encrypted","cookie","Cookie","Error","pushCookie","setHeader","attrs","path","domain","httpOnly","sameSite","overwrite","TypeError","expires","toString","toHeader","maxAge","toUTCString","RegExp","omit","values","newObject","values_1","isReactNative","product","urlParser","parser","createElement","href","out","props","pathname","setCookie","name$$1","expiresString","isBrowser","location","getCookie","size","object","find","callback","list","thisArg","sessionStorageKey","isIframe","self","Builder","apiKey","forceNewInstance","authToken","eventsQueue","throttledClearEventsQueue","processEventsQueue","env","isUsed","sessionId","getSessionId","targetContent","cookies","cachebust","overrideParams","noCache","overrideHost","preview","canTrack$","browserTrackingDisabled","apiKey$","editingMode$","editingModel$","autoTrack","isDevelopmentEnv","search","useNewContentApi","blockContentLoading","observersByKey","overrides","getContentQueue","priorContentQueue","testCookiePrefix","cookieQueue","singletonInstance","setUserAgent","bindMessageListeners","messageFrameLoaded","sessionStorage","getItem","setItem","debug","item","setTestsFromUrl","getOverridesFromQueryString","register","type","info","typeList","registry","message","parent","postMessage","registryChange","registerEditor","host","editors","registerPlugin","plugins","registerAction","action","actions","runAction","fields","import","packageName","System","defineProperty","_editingPage","editingPage","classList","remove","enumerable","configurable","prepareComponentSpecToSend","spec","__assign","inputs","input","keysToConvertFnToString_1","hooks","reduce","memo","class","registerComponent","component","addComponent","sendSpec","current","components","events","content-type","mode","doNotTrack","canTrack","editingMode","editingModel","findParentElement","checkElement","HTMLElement","parentElement","findBuilderParent","el","getAttribute","Boolean","track","eventName","metadata","sdkVersion","VERSION","meta","ownerId","userAttributes","getUserAttributes","Math","random","trackImpression","contentId","variationId","trackConversion","amount","hostname","port","trackInteraction","alreadyTrackedOne","event","targetBuilderElement","clientX","clientY","xOffset","targetRect","left","yOffset","xRatio","round","width","yRatio","height","targetOffset","y","builderTargetOffset","builderId","builderElementIndex","unique","num","modifySearch","group1","group2","getLocation","params","tests","builder","setTestCookie","resetOverrides","overrideUserAttributes","api","editing","frameEditing","setUserAttributes","isEditing","_b","_c","_d","origin","endsWith","source","info_1","hasComponent_1","every","thisInfo","animator","alias","entry","modelName","contentData","model","componentData","editingPageMode","flushGetContentQueue","_e","id_1","Function","finalResult","init","parsedLocation","isMobile","Android","BlackBerry","iOS","Opera","Windows","any","urlPath","device","instance","queueGetContent","matches","matchData","testVariationId","testVariationName","isEditingThisModel","currentObservable","initialContent","cache","observable","requestUrl","Authorization","resp","on","chunk","includes","usePastQueue","useQueue","queue","queryParams","pageQueryParams","useNewApi","isReact","prerender","queue_1","format","static","cacheSeconds","properties_1","hasParams","keyNames","join","queryStr","queue_2","keyName","sorted","testModifiedResults","processResultsForTests","queue_3","results","mappedResults","variations","cookieValue","getTestCookie","cookieVariation","variation","testRatio","future","setDate","getDate","getContent","isServer","referrer","TRACKED_KEY","getQueryParam","variable","vars","_window","currentScript","src","Shopify","checkout","parseFloat","payment_due","line_items","price"],"mappings":"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"}